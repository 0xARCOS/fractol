<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Experiencia inmersiva de fractales 3D psicodÃ©licos para mÃ³viles">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">

    <title>ğŸŒ€ Fractal 3D Experience</title>

    <!-- Performance optimizations -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Critical CSS inline for faster First Paint -->
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        html,body{width:100%;height:100%;overflow:hidden;background:#000;color:#fff;touch-action:none;position:fixed}
        #loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#000,#1a0033,#000);display:flex;align-items:center;justify-content:center;z-index:9999;transition:opacity .5s}
        #loading-screen.fade-out{opacity:0;pointer-events:none}
        #fractal-canvas{position:fixed;top:0;left:0;width:100%;height:100%;display:block;touch-action:none;z-index:1}
    </style>

    <!-- Load full CSS after critical content -->
    <link rel="stylesheet" href="style.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="style.css"></noscript>

</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="fractal-loader"></div>
            <h1>ğŸŒ€ FRACTAL DIMENSION</h1>
            <p>Preparando experiencia...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Canvas -->
    <canvas id="fractal-canvas"></canvas>

    <!-- Particle Background -->
    <div id="particles"></div>

    <!-- UI Controls -->
    <div id="ui-container" class="hidden">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="fractal-name" id="fractal-name">Mandelbulb</div>
            <div class="fps-counter" id="fps-counter">60 FPS</div>
        </div>

        <!-- Bottom Controls -->
        <div class="bottom-controls">
            <!-- Fractal Selector -->
            <div class="control-panel">
                <h3>ğŸ¨ Fractales ClÃ¡sicos</h3>
                <div class="fractal-buttons">
                    <button class="fractal-btn active" data-fractal="mandelbulb">
                        <span class="icon">ğŸ”®</span>
                        <span>Mandelbulb</span>
                    </button>
                    <button class="fractal-btn" data-fractal="mandelbrot3d">
                        <span class="icon">ğŸŒ€</span>
                        <span>Mandelbrot</span>
                    </button>
                    <button class="fractal-btn" data-fractal="julia3d">
                        <span class="icon">âœ¨</span>
                        <span>Julia 3D</span>
                    </button>
                    <button class="fractal-btn" data-fractal="sierpinski">
                        <span class="icon">ğŸ”º</span>
                        <span>Sierpinski</span>
                    </button>
                    <button class="fractal-btn" data-fractal="menger">
                        <span class="icon">ğŸ§Š</span>
                        <span>Menger</span>
                    </button>
                    <button class="fractal-btn" data-fractal="octahedron">
                        <span class="icon">ğŸ’</span>
                        <span>Octahedron</span>
                    </button>
                </div>
            </div>

            <!-- Advanced Fractals -->
            <div class="control-panel">
                <h3>ğŸš€ Fractales Avanzados</h3>
                <div class="fractal-buttons">
                    <button class="fractal-btn" data-fractal="mandelbox">
                        <span class="icon">ğŸ“¦</span>
                        <span>Mandelbox</span>
                    </button>
                    <button class="fractal-btn" data-fractal="apollonian">
                        <span class="icon">âšª</span>
                        <span>Apollonian</span>
                    </button>
                    <button class="fractal-btn" data-fractal="kleinian">
                        <span class="icon">ğŸŒ</span>
                        <span>Kleinian</span>
                    </button>
                    <button class="fractal-btn" data-fractal="lorenz">
                        <span class="icon">ğŸ¦‹</span>
                        <span>Lorenz</span>
                    </button>
                    <button class="fractal-btn" data-fractal="torusknot">
                        <span class="icon">ğŸ€</span>
                        <span>Torus Knot</span>
                    </button>
                    <button class="fractal-btn" data-fractal="psychedelic">
                        <span class="icon">ğŸŒˆ</span>
                        <span>Psychedelic</span>
                    </button>
                </div>
            </div>

            <!-- Color Schemes -->
            <div class="control-panel">
                <h3>ğŸ¨ Colores</h3>
                <div class="color-buttons">
                    <button class="color-btn" data-color="rainbow" style="background: linear-gradient(135deg, #ff0080, #ff8c00, #40e0d0);">Rainbow</button>
                    <button class="color-btn" data-color="galaxy" style="background: linear-gradient(135deg, #000428, #004e92);">Galaxy</button>
                    <button class="color-btn" data-color="fire" style="background: linear-gradient(135deg, #f00, #fc0, #ff0);">Fire</button>
                    <button class="color-btn" data-color="ocean" style="background: linear-gradient(135deg, #00f, #0ff, #0f0);">Ocean</button>
                    <button class="color-btn" data-color="neon" style="background: linear-gradient(135deg, #f0f, #0ff, #0f0);">Neon</button>
                    <button class="color-btn" data-color="sunset" style="background: linear-gradient(135deg, #ff6b6b, #feca57, #ee5a6f);">Sunset</button>
                </div>
            </div>

            <!-- Effects -->
            <div class="control-panel">
                <h3>âœ¨ Efectos</h3>
                <div class="effect-toggles">
                    <button class="toggle-btn active" data-effect="rotation" id="rotation-toggle">
                        <span>ğŸ”„</span> Auto-Rotar
                    </button>
                </div>
            </div>

            <!-- Speed Control -->
            <div class="control-panel">
                <h3>âš¡ Velocidad</h3>
                <input type="range" id="speed-slider" min="0" max="200" value="100" class="slider">
                <div class="slider-labels">
                    <span>Lento</span>
                    <span>RÃ¡pido</span>
                </div>
            </div>
        </div>

        <!-- Toggle UI Button -->
        <button id="toggle-ui" class="toggle-ui-btn">
            <span class="show-ui">â˜°</span>
            <span class="hide-ui">âœ•</span>
        </button>

        <!-- Reset Button -->
        <button id="reset-btn" class="reset-btn" title="Reset cÃ¡mara">
            <span>ğŸ¯</span>
        </button>

        <!-- Fullscreen Button -->
        <button id="fullscreen-btn" class="fullscreen-btn" title="Pantalla completa">
            <span>â›¶</span>
        </button>
    </div>

    <!-- Instructions Overlay -->
    <div id="instructions" class="instructions">
        <div class="instruction-content">
            <h2>ğŸŒ€ CÃ³mo usar</h2>
            <div class="instruction-item">
                <span class="instruction-icon">ğŸ‘†</span>
                <p><strong>Un dedo:</strong> Rotar fractal</p>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">ğŸ¤</span>
                <p><strong>Pinch:</strong> Zoom in/out</p>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">âœŒï¸</span>
                <p><strong>Dos dedos:</strong> Mover cÃ¡mara</p>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">ğŸ‘‡</span>
                <p><strong>Tap doble:</strong> Reset vista</p>
            </div>
            <button id="start-btn" class="start-btn">Comenzar Experiencia</button>
        </div>
    </div>

    <!-- Ultra-Light Fractal Engine (no dependencies!) -->
    <script src="app-lite.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('âœ… Service Worker registered:', reg.scope))
                    .catch(err => console.log('âŒ Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
